<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SHOXA Admin - Business Portal</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css">
</head>

<body>
  <div id="app">
    <!-- Auth Pages -->
    <div id="auth-container" class="auth-container">
      <!-- Login Form -->
      <div id="login-page" class="auth-page">
        <div class="auth-card">
          <div class="auth-logo">
            <img src="logo.png" alt="SHOXA" class="logo-icon">
            <h1>SHOXA</h1>
            <p>Business Portal</p>
          </div>
          <form id="login-form" class="auth-form">
            <div class="form-group">
              <label for="login-email">Email</label>
              <input type="email" id="login-email" placeholder="your@email.com" required>
            </div>
            <div class="form-group">
              <label for="login-password">Password</label>
              <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            </div>
            <button type="submit" class="btn btn-primary btn-full">
              <span>Sign In</span>
              <i class="ri-arrow-right-line"></i>
            </button>
          </form>
          <p class="auth-switch">
            Don't have an account? <a href="#" id="show-register">Sign Up</a>
          </p>
        </div>
      </div>

      <!-- Register Form -->
      <div id="register-page" class="auth-page hidden">
        <div class="auth-card">
          <div class="auth-logo">
            <img src="logo.png" alt="SHOXA" class="logo-icon">
            <h1>Join SHOXA</h1>
            <p>Register your business</p>
          </div>
          <form id="register-form" class="auth-form">
            <div class="form-group">
              <label for="register-name">Your Name</label>
              <input type="text" id="register-name" placeholder="John Doe" required>
            </div>
            <div class="form-group">
              <label for="register-email">Email</label>
              <input type="email" id="register-email" placeholder="your@email.com" required>
            </div>
            <div class="form-group">
              <label for="register-password">Password</label>
              <input type="password" id="register-password" placeholder="Min 6 characters" required>
            </div>
            <button type="submit" class="btn btn-primary btn-full">
              <span>Create Account</span>
              <i class="ri-arrow-right-line"></i>
            </button>
          </form>
          <p class="auth-switch">
            Already have an account? <a href="#" id="show-login">Sign In</a>
          </p>
        </div>
      </div>
    </div>

    <!-- Onboarding Flow (shown after registration or if no business set up) -->
    <div id="onboarding-container" class="onboarding-container hidden">

      <!-- Step 1: Business Type Selection -->
      <div id="onboard-step-1" class="onboard-step active">
        <div class="onboard-card">
          <div class="onboard-header">
            <h1>Welcome to SHOXA! üéâ</h1>
            <p>Let's set up your business. What type of business do you have?</p>
          </div>

          <div class="business-type-grid">
            <div class="business-type-card" data-type="shop" onclick="selectBusinessType('shop')">
              <div class="type-icon shop">
                <i class="ri-store-2-line"></i>
              </div>
              <h3>Shop / Store</h3>
              <p>I sell products to customers</p>
              <ul class="type-examples">
                <li>Pharmacy</li>
                <li>Grocery Store</li>
                <li>Restaurant / Cafe</li>
                <li>Bakery</li>
                <li>Retail Store</li>
              </ul>
            </div>

            <div class="business-type-card" data-type="amenity" onclick="selectBusinessType('amenity')">
              <div class="type-icon amenity">
                <i class="ri-building-4-line"></i>
              </div>
              <h3>Amenity / Service</h3>
              <p>I provide services or information</p>
              <ul class="type-examples">
                <li>Hospital / Clinic</li>
                <li>Bank</li>
                <li>School</li>
                <li>Park / Recreation</li>
                <li>Government Office</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: Shop Sub-type (only for shops) -->
      <div id="onboard-step-2" class="onboard-step">
        <div class="onboard-card">
          <button class="onboard-back" onclick="goToOnboardStep(1)">
            <i class="ri-arrow-left-line"></i> Back
          </button>
          <div class="onboard-header">
            <h1>How do you manage inventory?</h1>
            <p>Choose how you want to manage your products on SHOXA</p>
          </div>

          <div class="shop-mode-grid">
            <div class="shop-mode-card" data-mode="pos" onclick="selectShopMode('pos')">
              <div class="mode-icon pos">
                <i class="ri-qr-scan-2-line"></i>
              </div>
              <h3>I have a POS System</h3>
              <p>Connect your existing checkout system for automatic sync</p>
              <div class="mode-features">
                <span class="feature-tag"><i class="ri-refresh-line"></i> Auto-sync products</span>
                <span class="feature-tag"><i class="ri-database-line"></i> Real-time inventory</span>
                <span class="feature-tag"><i class="ri-line-chart-line"></i> Advanced analytics</span>
              </div>
              <div class="pos-logos">
                <span class="pos-logo">Square</span>
                <span class="pos-logo">Clover</span>
                <span class="pos-logo">Toast</span>
                <span class="pos-logo">iiko</span>
              </div>
            </div>

            <div class="shop-mode-card" data-mode="manual" onclick="selectShopMode('manual')">
              <div class="mode-icon manual">
                <i class="ri-edit-box-line"></i>
              </div>
              <h3>I'll Manage Manually</h3>
              <p>Add and update products yourself through our dashboard</p>
              <div class="mode-features">
                <span class="feature-tag"><i class="ri-add-line"></i> Easy product entry</span>
                <span class="feature-tag"><i class="ri-upload-cloud-line"></i> CSV bulk import</span>
                <span class="feature-tag"><i class="ri-smartphone-line"></i> Simple interface</span>
              </div>
              <p class="mode-note">Perfect for small businesses without digital checkout</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3A: POS Selection (for POS mode) -->
      <div id="onboard-step-3-pos" class="onboard-step">
        <div class="onboard-card">
          <button class="onboard-back" onclick="goToOnboardStep(2)">
            <i class="ri-arrow-left-line"></i> Back
          </button>
          <div class="onboard-header">
            <h1>Connect Your POS</h1>
            <p>Select your point-of-sale system and enter your API credentials</p>
          </div>

          <div class="pos-selector-grid">
            <div class="pos-select-card" data-pos="square" onclick="selectPOS('square')">
              <i class="ri-square-fill" style="color: #006AFF; font-size: 32px;"></i>
              <span>Square</span>
            </div>
            <div class="pos-select-card" data-pos="clover" onclick="selectPOS('clover')">
              <i class="ri-leaf-fill" style="color: #4CAF50; font-size: 32px;"></i>
              <span>Clover</span>
            </div>
            <div class="pos-select-card" data-pos="toast" onclick="selectPOS('toast')">
              <i class="ri-restaurant-line" style="color: #FF5722; font-size: 32px;"></i>
              <span>Toast</span>
            </div>
            <div class="pos-select-card" data-pos="iiko" onclick="selectPOS('iiko')">
              <i class="ri-pie-chart-line" style="color: #9C27B0; font-size: 32px;"></i>
              <span>iiko</span>
            </div>
            <div class="pos-select-card" data-pos="rkeeper" onclick="selectPOS('rkeeper')">
              <i class="ri-database-2-line" style="color: #2196F3; font-size: 32px;"></i>
              <span>R-Keeper</span>
            </div>
            <div class="pos-select-card" data-pos="other" onclick="selectPOS('other')">
              <i class="ri-apps-2-line" style="color: #607D8B; font-size: 32px;"></i>
              <span>Other</span>
            </div>
          </div>

          <div id="pos-api-form" class="pos-api-form hidden">
            <div class="form-group">
              <label>API Key / Access Token</label>
              <input type="text" id="pos-api-key" placeholder="Paste your API key here">
              <p class="form-hint">You can find this in your <span id="pos-name">POS</span> dashboard settings</p>
            </div>
            <div class="form-group">
              <label>Location ID (Optional)</label>
              <input type="text" id="pos-location-id" placeholder="If you have multiple locations">
            </div>
            <button class="btn btn-primary btn-full" onclick="connectPOS()">
              <i class="ri-link"></i>
              Connect & Sync Products
            </button>
            <button class="btn btn-ghost btn-full" onclick="skipPOS()">
              Skip for now, I'll connect later
            </button>
          </div>
        </div>
      </div>

      <!-- Step 3B: Amenity Details (for amenities) -->
      <div id="onboard-step-3-amenity" class="onboard-step">
        <div class="onboard-card">
          <button class="onboard-back" onclick="goToOnboardStep(1)">
            <i class="ri-arrow-left-line"></i> Back
          </button>
          <div class="onboard-header">
            <h1>Tell us about your place</h1>
            <p>This information will appear on your public page</p>
          </div>

          <form id="amenity-form" class="amenity-form">
            <div class="form-group">
              <label>Amenity Type</label>
              <select id="amenity-type" required>
                <option value="">Select type...</option>
                <option value="hospital">üè• Hospital / Clinic</option>
                <option value="bank">üè¶ Bank / Financial</option>
                <option value="school">üè´ School / Education</option>
                <option value="park">üå≥ Park / Recreation</option>
                <option value="government">üèõÔ∏è Government Office</option>
                <option value="religious">üïå Religious Place</option>
                <option value="gym">üí™ Gym / Sports</option>
                <option value="salon">üíá Salon / Beauty</option>
                <option value="repair">üîß Repair Service</option>
                <option value="other">üìç Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Name</label>
              <input type="text" id="amenity-name" placeholder="Your business name" required>
            </div>
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" id="amenity-phone" placeholder="+998 90 123 4567">
            </div>
            <div class="form-group">
              <label>Brief Description</label>
              <textarea id="amenity-desc" rows="3" placeholder="What services do you provide?"></textarea>
            </div>
            <button type="button" class="btn btn-primary btn-full" onclick="saveAmenityAndContinue()">
              <span>Continue to Dashboard</span>
              <i class="ri-arrow-right-line"></i>
            </button>
          </form>
        </div>
      </div>

      <!-- Step 4: Shop Basic Info (for all shops) -->
      <div id="onboard-step-4" class="onboard-step">
        <div class="onboard-card">
          <button class="onboard-back" onclick="goToOnboardStep(selectedShopMode === 'pos' ? '3-pos' : 2)">
            <i class="ri-arrow-left-line"></i> Back
          </button>
          <div class="onboard-header">
            <h1>Almost done! üéØ</h1>
            <p>Just a few details about your shop</p>
          </div>

          <form id="shop-basic-form" class="shop-basic-form">
            <div class="form-group">
              <label>Shop Name</label>
              <input type="text" id="shop-onboard-name" placeholder="Your shop name" required>
            </div>
            <div class="form-group">
              <label>Shop Category</label>
              <select id="shop-category" required>
                <option value="">Select category...</option>
                <option value="pharmacy">üíä Pharmacy</option>
                <option value="grocery">üõí Grocery Store</option>
                <option value="restaurant">üçΩÔ∏è Restaurant</option>
                <option value="cafe">‚òï Cafe</option>
                <option value="bakery">ü•ê Bakery</option>
                <option value="electronics">üì± Electronics</option>
                <option value="clothing">üëï Clothing</option>
                <option value="beauty">üíÑ Beauty & Cosmetics</option>
                <option value="hardware">üî® Hardware</option>
                <option value="other">üì¶ Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" id="shop-phone" placeholder="+998 90 123 4567">
            </div>
            <button type="button" class="btn btn-primary btn-full" onclick="completeOnboarding()">
              <span>Go to Dashboard</span>
              <i class="ri-arrow-right-line"></i>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-container" class="dashboard-container hidden">
      <!-- Sidebar -->
      <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
          <img src="logo.png" alt="SHOXA" class="logo-icon">
          <span class="logo-text">SHOXA</span>
        </div>
        <nav class="sidebar-nav" id="sidebar-nav">
          <!-- Navigation items populated by JS based on business type -->
        </nav>
        <div class="sidebar-footer">
          <div class="user-info" id="user-info">
            <span class="user-name">Shop Name</span>
            <span class="user-type">Shop ‚Ä¢ Manual</span>
          </div>
          <button id="logout-btn" class="btn btn-ghost btn-full">
            <i class="ri-logout-box-line"></i>
            <span>Logout</span>
          </button>
        </div>
      </aside>

      <!-- Mobile Header -->
      <header class="mobile-header">
        <button id="menu-toggle" class="menu-toggle">
          <i class="ri-menu-line"></i>
        </button>
        <span class="logo-text">SHOXA</span>
        <div class="header-actions">
          <button id="mobile-logout" class="btn-icon">
            <i class="ri-logout-box-line"></i>
          </button>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content" id="main-content">
        <!-- Pages will be dynamically generated based on business type -->
      </main>
    </div>

    <!-- Modals -->

    <!-- Product Modal -->
    <div id="product-modal" class="modal hidden">
      <div class="modal-backdrop" onclick="closeProductModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="product-modal-title">Add Product</h2>
          <button class="btn-icon" onclick="closeProductModal()">
            <i class="ri-close-line"></i>
          </button>
        </div>
        <form id="product-form" class="modal-body">
          <input type="hidden" id="product-id">
          <div class="form-group">
            <label for="product-name">Product Name</label>
            <input type="text" id="product-name" required>
          </div>
          <div class="form-group">
            <label for="product-sku">SKU / Barcode</label>
            <input type="text" id="product-sku" placeholder="Auto-generated if empty">
          </div>
          <div class="form-group">
            <label for="product-description">Description</label>
            <textarea id="product-description" rows="2"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="product-price">Price (UZS)</label>
              <input type="number" id="product-price" step="100" required>
            </div>
            <div class="form-group">
              <label for="product-discount">Sale Price</label>
              <input type="number" id="product-discount" step="100">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="product-stock">Stock Quantity</label>
              <input type="number" id="product-stock" value="0">
            </div>
            <div class="form-group">
              <label for="product-reorder">Low Stock Alert</label>
              <input type="number" id="product-reorder" value="10">
            </div>
          </div>
          <div class="form-group">
            <label for="product-category">Category</label>
            <input type="text" id="product-category" placeholder="e.g. Medicine, Food">
          </div>
          <div class="form-group">
            <label>Product Image</label>
            <div class="image-upload product-image-upload">
              <input type="file" id="product-image-input" accept="image/*" hidden>
              <div class="upload-placeholder" onclick="document.getElementById('product-image-input').click()">
                <i class="ri-image-add-line"></i>
                <span>Upload Image</span>
              </div>
              <img id="product-image-preview" class="upload-preview hidden" alt="Product">
            </div>
          </div>
        </form>
        <div class="modal-footer">
          <button class="btn btn-ghost" onclick="closeProductModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveProduct()">Save Product</button>
        </div>
      </div>
    </div>

    <!-- Post Modal -->
    <div id="post-modal" class="modal hidden">
      <div class="modal-backdrop" onclick="closePostModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Create Post</h2>
          <button class="btn-icon" onclick="closePostModal()">
            <i class="ri-close-line"></i>
          </button>
        </div>
        <form id="post-form" class="modal-body">
          <div class="form-group">
            <label for="post-content">What's new?</label>
            <textarea id="post-content" rows="4" placeholder="Share updates, news, promotions..."></textarea>
          </div>
          <div class="form-group">
            <label>Add Images</label>
            <div class="image-upload post-image-upload">
              <input type="file" id="post-image-input" accept="image/*" multiple hidden>
              <div class="upload-placeholder" onclick="document.getElementById('post-image-input').click()">
                <i class="ri-image-add-line"></i>
                <span>Add Images</span>
              </div>
            </div>
            <div id="post-images-preview" class="images-preview"></div>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="post-is-story">
              Post as Story (expires in 24 hours)
            </label>
          </div>
        </form>
        <div class="modal-footer">
          <button class="btn btn-ghost" onclick="closePostModal()">Cancel</button>
          <button class="btn btn-primary" onclick="savePost()">Publish</button>
        </div>
      </div>
    </div>

    <!-- Service Modal (for amenities) -->
    <div id="service-modal" class="modal hidden">
      <div class="modal-backdrop" onclick="closeServiceModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Service</h2>
          <button class="btn-icon" onclick="closeServiceModal()">
            <i class="ri-close-line"></i>
          </button>
        </div>
        <form id="service-form" class="modal-body">
          <div class="form-group">
            <label>Service Name</label>
            <input type="text" id="service-name" required placeholder="e.g. General Consultation">
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea id="service-desc" rows="2" placeholder="What does this service include?"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Price (UZS)</label>
              <input type="number" id="service-price" placeholder="Optional">
            </div>
            <div class="form-group">
              <label>Duration</label>
              <input type="text" id="service-duration" placeholder="e.g. 30 min">
            </div>
          </div>
        </form>
        <div class="modal-footer">
          <button class="btn btn-ghost" onclick="closeServiceModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveService()">Save Service</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden">
      <span id="toast-message"></span>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay hidden">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Telegram Upload Helper -->
  <script src="js/telegram.js"></script>

  <!-- App Scripts -->
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/onboarding.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/products.js"></script>
  <script src="js/posts.js"></script>
  <script src="js/app.js"></script>
</body>

</html>